*** Settings ***
Library           AppiumLibrary
Library           Collections
Library           Selenium2Library
Library           DatabaseLibrary
Resource          发现页关键字.txt
Resource          买金关键字.txt
Resource          首页关键字.txt
Resource          数据库关键字.txt
Resource          买金呗通用变量.txt

*** Variables ***

*** Keywords ***
启动APP
    [Arguments]    ${platformName}    ${platformVersion}    ${deviceName}    ${appPackage}    ${appActivity}
    Open Application    http://localhost:4723/wd/hub    platformName=${platformName}    platformVersion=${platformVersion}    deviceName=${deviceName}    appPackage=${appPackage}    appActivity=${appActivity}
    ...    unicodeKeyboard=True    resetKeyboard=True

安装买金呗APP
    [Arguments]    ${platformName}    ${platformVersion}    ${deviceName}    ${app}
    Open Application    http://localhost:4723/wd/hub    platformName=${platformName}    platformVersion=${platformVersion}    deviceName=${deviceName}    app=${CURDIR}/安装包/${app}

关闭弹窗
    等待时间    3
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/imgClose
    等待时间    2
    AppiumLibrary.Click Element    id=com.hsd.finance:id/imgClose
    log    弹窗已关闭

卸载APP
    [Arguments]    ${APPID}
    Remove Application    ${APPID}

切换首页
    AppiumLibrary.Click Text    首页

切换买金
    AppiumLibrary.Wait Until Page Contains Element    xpath=//android.widget.RelativeLayout[contains(@index,1)]/android.widget.TextView[contains(@text,'买金')]    #切换买金
    AppiumLibrary.Click Element    xpath=//android.widget.RelativeLayout[contains(@index,1)]/android.widget.TextView[contains(@text,'买金')]    #切换买金
    等待时间    2

切换发现
    AppiumLibrary.Wait Until Page Contains    发现
    AppiumLibrary.Click Text    发现

切换我的
    AppiumLibrary.Wait Until Page Contains    我的
    AppiumLibrary.Click Text    我的
    等待时间    2

关闭公告
    等待时间    10
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/ibCloseAnnouce
    AppiumLibrary.Click Element    id=com.hsd.finance:id/ibCloseAnnouce    #关闭公告

点击新手指引
    等待时间    10
    AppiumLibrary.Click Text    新手指引

点击了解我们
    等待时间    10
    AppiumLibrary.Click Text    了解我们

点击安全保障
    等待时间    10
    AppiumLibrary.Click Text    安全保障

点击邀请有礼
    等待时间    10
    AppiumLibrary.Click Text    邀请有礼

发起邀请
    AppiumLibrary.Wait Until Page Contains Element    xpath=//android.view.View[contains(@index,5)]    #发起邀请
    AppiumLibrary.Click Element    xpath=//android.view.View[contains(@index,5)]    #发起邀请

点击产品介绍
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/iv_productintro
    AppiumLibrary.Click Element    id=com.hsd.finance:id/iv_productintro    #点击产品介绍

点击金价走势
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/iv_fresh
    AppiumLibrary.Click Element    id=com.hsd.finance:id/iv_fresh    #点击金价走势

点击实时金价
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/layouttrent
    AppiumLibrary.Click Element    id=com.hsd.finance:id/layouttrent    #点击实时金价
    等待时间    2

点击立即购买进入买金页面
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/btn_buy_gold
    AppiumLibrary.Click Element    id=com.hsd.finance:id/btn_buy_gold    #点击立即购买按钮-进入买金页面

今日推荐-立即购买按钮
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/btn_older_buy
    AppiumLibrary.Click Element    id=com.hsd.finance:id/btn_older_buy    #今日推荐立即购买

进入金饰页面
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/iv_shiping
    AppiumLibrary.Click Element    id=com.hsd.finance:id/iv_shiping    #点击金饰

输入手机号码
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/edit_phone    #等待元素出现，再输入
    AppiumLibrary.Click Element    id=com.hsd.finance:id/edit_phone
    AppiumLibrary.Clear Text    id=com.hsd.finance:id/edit_phone
    等待时间    2
    AppiumLibrary.Input Text    id=com.hsd.finance:id/edit_phone    ${手机号码}    #输入手机号码
    等待时间    2
    检查手机号码正确

输入密码
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/login_pwd_edit    #等待元素出现，再输入
    AppiumLibrary.Click Element    id=com.hsd.finance:id/login_pwd_edit
    AppiumLibrary.Clear Text    id=com.hsd.finance:id/login_pwd_edit
    等待时间    2
    AppiumLibrary.Input Password    id=com.hsd.finance:id/login_pwd_edit    ${登录密码}    #输入登录密码
    等待时间    1
    隐藏键盘
    AppiumLibrary.Click Element    id=com.hsd.finance:id/login_btn    #点击登录
    等待时间    2

打开合时代登录
    Wait Until Page Contains Element    id=com.hsd.finance:id/tvLoginHsd
    Click Element    id=com.hsd.finance:id/tvLoginHsd    #点击合时代

点击卖金
    [Documentation]    1、金价走势图页面-卖金按钮
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/btn_sell    #等待元素出现
    AppiumLibrary.Click Element    id=com.hsd.finance:id/btn_sell    #点击卖金按钮
    等待时间    2

点击返回键
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/tvBack    #等待返回键出现
    AppiumLibrary.Click Element    id=com.hsd.finance:id/tvBack    #点击返回键
    等待时间    2

点击设置按钮
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/titleViewleft    #等待设置按钮出现
    AppiumLibrary.Click Element    id=com.hsd.finance:id/titleViewleft    #点击设置按钮
    等待时间    2

点击安全退出按钮
    AppiumLibrary.Wait Until Element Is Visible    id=com.hsd.finance:id/tvPersetLogout    #等待元素可见
    AppiumLibrary.Click Element    id=com.hsd.finance:id/tvPersetLogout    #点击退出登录

等待时间
    [Arguments]    ${waitting}
    sleep    ${waitting}

点击存入
    AppiumLibrary.Wait Until Page Contains    存入    #等待存入按钮出现
    AppiumLibrary.Click Text    存入    #点击存入按钮

点击立即存入
    等待时间    2
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/tvCurrentBuy    #金荷包页面等待元素出现
    AppiumLibrary.Click Element    id=com.hsd.finance:id/tvCurrentBuy    #点击立即存入按钮

点击左上角公告
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/iv_title_gonggao    #点击公告
    AppiumLibrary.Click Element    id=com.hsd.finance:id/iv_title_gonggao    #点击公告

元素不存在
    [Arguments]    ${yuansu}
    等待时间    2
    AppiumLibrary.Page Should Not Contain Element    ${yuansu}

点击滚动公告信息
    等待时间    10
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/tvNoticeTitle    #点击滚动公告
    AppiumLibrary.Click Element    id=com.hsd.finance:id/tvNoticeTitle    #点击滚动公告

页面存在元素
    [Arguments]    ${yuansu}
    等待时间    1
    AppiumLibrary.Page Should Contain Element    ${yuansu}

详情页面向上滑动
    等待时间    5
    ${size}    获取向上元素尺寸    id=com.hsd.finance:id/container    #获取元素尺寸
    ${width}    Evaluate    ${size}.get('width')    #获取x轴数据
    ${height}    Evaluate    ${size}.get('height')    #获取y轴数据
    ${x_1}    Evaluate    ${width}*0.5
    ${y_1}    Evaluate    ${height}*0.85
    ${x_2}    Evaluate    ${x_1}*0.5
    ${y_2}    Evaluate    ${y_1}*0.85
    AppiumLibrary.Swipe    ${x_1}    ${y_1}    ${x_2}    ${y_2}

退出登录
    点击设置按钮
    屏幕截图
    向上滑动
    点击安全退出按钮
    log    退出登录
    等待时间    5

屏幕截图
    AppiumLibrary.Capture Page Screenshot    #屏幕截图
    等待时间    2

判断弹窗是否存在
    等待时间    10
    ${status}    Run Keyword And Return Status    页面存在元素    id=com.hsd.finance:id/imgClose
    Run Keyword If    '${status}'=='True'    Run Keyword    关闭弹窗
    ...    ELSE    Run Keyword    log    弹窗已出现过

登录前判断账号已登录
    等待页面文案出现    立即购买    #等待立即购买素出现
    切换我的
    屏幕截图
    ${yuansu}    Run Keyword And Return Status    页面存在元素    id=com.hsd.finance:id/titleViewleft
    Run Keyword If    '${yuansu}'=='True'    Run Keyword    退出登录
    ...    ELSE    Run Keyword    未登录时关闭我的页面

判断账号未登录
    等待页面文案出现    立即购买    #等待立即购买素出现
    切换我的
    屏幕截图
    ${yuansu}    Run Keyword And Return Status    页面存在元素    id=com.hsd.finance:id/titleViewleft
    Run Keyword If    '${yuansu}'=='True'    log    登录成功
    ...    ELSE    安全登录
    切换首页

安全登录
    输入手机号码
    屏幕截图
    输入密码
    屏幕截图
    log    登录成功

未登录时关闭我的页面
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/tvBack
    等待时间    1
    AppiumLibrary.Click Element    id=com.hsd.finance:id/tvBack

关闭订单页面弹窗
    等待时间    3
    AppiumLibrary.Wait Until Page Contains Element    id=com.hsd.finance:id/ivClose
    等待时间    2
    AppiumLibrary.Click Element    id=com.hsd.finance:id/ivClose
    log    弹窗已关闭

检查手机号码正确
    ${mobpone}    获取title    id=com.hsd.finance:id/edit_phone
    Run Keyword If    '${mobpone}'=='189 2848 0059'    手机号码下一步
    ...    ELSE    重新输入手机号码

重新输入手机号码
    AppiumLibrary.Click Element    id=com.hsd.finance:id/edit_phone
    AppiumLibrary.Clear Text    id=com.hsd.finance:id/edit_phone
    等待时间    2
    AppiumLibrary.Input Text    id=com.hsd.finance:id/edit_phone    ${手机号码}
    等待时间    1
    隐藏键盘
    AppiumLibrary.Click Element    id=com.hsd.finance:id/login_next_btn
    等待时间    1

手机号码下一步
    隐藏键盘
    AppiumLibrary.Click Element    id=com.hsd.finance:id/login_next_btn    #点击下一步

向左滑动
    ${size}    AppiumLibrary.Get Element Size    id=com.hsd.finance:id/ivSplash
    ${width}    Evaluate    ${size}.get('width')    #获取x轴数据
    ${height}    Evaluate    ${size}.get('height')    #获取y轴数据
    ${x_1}    Evaluate    ${width}*0.75
    ${y_1}    Evaluate    ${height}*0.5
    ${x_2}    Evaluate    ${x_1}*0.05
    AppiumLibrary.Swipe    ${x_1}    ${y_1}    ${x_2}    ${y_1}
    等待时间    4

向右滑动
    ${size}    AppiumLibrary.Get Element Size    id=com.hsd.finance:id/container
    ${width}    Evaluate    ${size}.get('width')    #获取x轴数据
    ${height}    Evaluate    ${size}.get('height')    #获取y轴数据
    ${x_1}    Evaluate    ${width}*0.05
    ${y_1}    Evaluate    ${height}*0.5
    ${x_2}    Evaluate    ${x_1}*0.75
    AppiumLibrary.Swipe    ${x_1}    ${y_1}    ${x_2}    ${y_1}

启动页面
    等待时间    5
    页面存在元素    id=com.hsd.finance:id/ivSplash
    向左滑动
    页面存在元素    id=com.hsd.finance:id/ivSplash
    向左滑动
    页面存在元素    id=com.hsd.finance:id/ivSplash
    向左滑动
    等待时间    2
    AppiumLibrary.Click Element    id=com.hsd.finance:id/btnExperence
    等待时间    5
